{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="{% static 'css/choose_table_styles.css' %}">
    <style>
        .center {
            justify-content: center;
            align-items: center;
            height: 100vh; /* Adjust based on your layout */
        }

        #tableMap {
            width: 50%; /* Set the width of your image */
            height: 600px; /* Set the height of your image */
            position: relative;
            margin: auto;
        }
        .table-marker {
            width: 30px;
            height: 30px;
            background-color: #3498db;
            border-radius: 50%;
            position: absolute;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-weight: bold;
        }
        .table-marker.booked {
            background-color: #e74c3c;
        }
        .table-marker.selected {
            background-color: #e74c3c; /* You can modify this color as needed */
        }
        /* Add any additional styles as needed */
    </style>
    <title>Choose Table</title>
</head>
<body>
    <h1>Choose Table</h1>
    <div id="tableMap" class="center">
        <img src="{% static 'img/restaurant_map.png' %}" alt="Table Map" style="width: 100%; height: 100%;">
    </div>

    <form method="post" id="tableForm">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit">Next</button>
    </form>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const tableMap = document.getElementById('tableMap');
            const form = document.getElementById('tableForm');
            let selectedTableId = null;

            const tableMarkers = [
                { id: 1, left: '8.5%', top: '10%' },
                { id: 2, left: '25%', top: '10%' },
                { id: 3, left: '55%', top: '10%' },
                { id: 4, left: '71.5%', top: '10%' },
                { id: 5, left: '5%', top: '25%' },
                { id: 6, left: '5%', top: '40%' },
                { id: 7, left: '5%', top: '55%' },
                { id: 8, left: '24%', top: '25%' },
                { id: 9, left: '33%', top: '25%' },
                { id: 10, left: '24%', top: '40%' },
                { id: 11, left: '33%', top: '40%' },
                { id: 12, left: '24%', top: '55%' },
                { id: 13, left: '33%', top: '55%' },
                { id: 14, left: '50%', top: '25%' },
                { id: 15, left: '50%', top: '40%' },
                { id: 16, left: '60%', top: '55%' },
                { id: 17, left: '60%', top: '25%' },
                { id: 18, left: '50%', top: '55%' },
                { id: 19, left: '60%', top: '40%' },
                { id: 20, left: '90%', top: '30%' },
                { id: 21, left: '90%', top: '40%' },
                { id: 22, left: '90%', top: '50%' },
                { id: 23, left: '90%', top: '60%' },
                // Add more table markers as needed
            ];

            tableMarkers.forEach(marker => {
                const tableMarker = document.createElement('div');
                tableMarker.className = 'table-marker';
                tableMarker.style.left = marker.left;
                tableMarker.style.top = marker.top;
                tableMarker.innerText = marker.id; // Add the table number

                // Check if the table is booked and mark it as booked
                if (isTableBooked(marker.id)) {
                    tableMarker.classList.add('booked');
                }

                // Add click event to select the table
                tableMarker.addEventListener('click', function () {
                    if (tableMarker.classList.contains('booked')) {
                        return; // Do nothing if the table is booked
                    }

                    // Remove styling from previously selected tables
                    document.querySelectorAll('.table-marker').forEach(el => {
                        el.classList.remove('selected');
                    });

                    // Add styling to the selected table marker
                    tableMarker.classList.add('selected');

                    // Set the selected table ID
                    selectedTableId = marker.id;
                });

                tableMap.appendChild(tableMarker);
            });

            form.addEventListener('submit', function (event) {
                // Ensure a table is selected before submitting the form
                if (!selectedTableId) {
                    alert("Please select a table before proceeding.");
                    event.preventDefault(); // Prevent the form from submitting
                    return;
                }

                // Create a hidden input to store the selected table ID
                const selectedTableInput = document.createElement('input');
                selectedTableInput.type = 'hidden';
                selectedTableInput.name = 'selected_table';
                selectedTableInput.value = selectedTableId;
                form.appendChild(selectedTableInput);

                // Optionally, alert the selected table ID for debugging
                // alert("Selected Table: " + selectedTableId);
            });

            function isTableBooked(tableId) {
                // Check the booked status of each table
                {% for table in tables %}
                    {% if table.booked %}
                        if (tableId === {{ table.table_id }}) {
                            return true; // Booked table
                        }
                    {% endif %}
                {% endfor %}
                return false; // Not booked
            }

        });
    </script>
</body>
</html>